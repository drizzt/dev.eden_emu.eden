app-id: dev.eden_emu.eden
runtime: org.kde.Platform
runtime-version: '6.9'
sdk: org.kde.Sdk
build-options:
  cflags: -O3
  cxxflags: -O3
command: eden-launcher
finish-args:
  - --device=all
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --share=network
  - --share=ipc
  - --filesystem=xdg-run/app/com.discordapp.Discord:ro
  - --filesystem=home:ro
  - --filesystem=/run/media:ro
  - --talk-name=org.freedesktop.login1.Manager
modules:
  - name: eden
    buildsystem: cmake-ninja
    builddir: true
    config-opts:
      - -Wno-dev
      - -DYUZU_USE_CPM:BOOL=ON
      # Taken from .ci/linux/build.sh
      - -DCMAKE_BUILD_TYPE:STRING=Release
      - -DENABLE_QT_TRANSLATION:BOOL=ON
      - -DUSE_DISCORD_PRESENCE:BOOL=ON
      - -DYUZU_USE_BUNDLED_QT:BOOL=OFF
      - -DYUZU_USE_BUNDLED_SDL2:BOOL=OFF
      - -DYUZU_USE_EXTERNAL_SDL2:BOOL=ON
      - -DYUZU_TESTS:BOOL=OFF
      - -DYUZU_USE_QT_MULTIMEDIA:BOOL=ON
      - -DYUZU_USE_QT_WEB_ENGINE:BOOL=OFF
      - -DYUZU_USE_FASTER_LD:BOOL=ON
      - -DYUZU_ENABLE_LTO:BOOL=ON
      - -DDYNARMIC_ENABLE_LTO:BOOL=ON
      - -DYUZU_ROOM:BOOL=ON
      - -DYUZU_ROOM_STANDALONE:BOOL=OFF
      - -DYUZU_CMD:BOOL=OFF
    secret-opts:
      - -DYUZU_BUILD_PRESET:STRING=$BUILD_PRESET
      - -DYUZU_SYSTEM_PROFILE:STRING=$SYSTEM_PROFILE
    build-options:
      strip: true
      no-debuginfo: true
    post-install:
      - install -Dm755 ../eden-launcher.sh /app/bin/eden-launcher
      - install -Dm644 ../dev.eden_emu.eden.metainfo.xml /app/share/metainfo/dev.eden_emu.eden.metainfo.xml
      - install -Dm644 ../dist/dev.eden_emu.eden.svg /app/share/icons/hicolor/scalable/apps/dev.eden_emu.eden.svg
      - desktop-file-edit --set-key StartupWMClass --set-value eden --set-key Exec
        --set-value eden-launcher /app/share/applications/dev.eden_emu.eden.desktop
    sources:
      - type: git
        url: https://git.eden-emu.dev/eden-emu/eden.git
      - type: file
        path: dev.eden_emu.eden.metainfo.xml
      - type: file
        path: eden-launcher.sh
      - type: file
        path: compatibility_list.json
        dest: dist/compatibility_list
      - type: archive
        dest: .cache/cpm/boost/1.89.0
        url: https://github.com/boostorg/boost/releases/download/boost-1.89.0/boost-1.89.0-cmake.tar.xz
        sha512: 4fb7f6fde92762305aad8754d7643cd918dd1f3f67e104e9ab385b18c73178d72a17321354eb203b790b6702f2cf6d725a5d6e2dfbc63b1e35f9eb59fb42ece9
      - type: shell
        commands:
          - patch -Np1 -d .cache/cpm/boost/1.89.0 < .patch/boost/0001-clang-cl.patch
          - patch -Np1 -d .cache/cpm/boost/1.89.0 < .patch/boost/0002-use-marmasm.patch
          - patch -Np1 -d .cache/cpm/boost/1.89.0 < .patch/boost/0003-armasm-options.patch
      - type: archive
        dest: .cache/cpm/nlohmann_json/55f9
        url: https://github.com/nlohmann/json/archive/55f93686c0.zip
        sha512: b739749b066800e21154506ea150d2c5cbce8a45344177f46f884547a1399d26753166fd0df8135269ce28cf223552b1b65cd625b88c844d54753f2434900486
      - type: archive
        dest: .cache/cpm/enet/2662
        url: https://github.com/lsalzman/enet/archive/2662c0de09.zip
        sha512: 3de1beb4fa3d6b1e03eda8dd1e7580694f854af3ed3975dcdabfdcdf76b97f322b9734d35ea7f185855bb490d957842b938b26da4dd2dfded509390f8d2794dd
      - type: archive
        dest: .cache/cpm/vulkanutilitylibraries/1.4.326
        url: https://git.crueter.xyz/scripts/VulkanUtilityHeaders/releases/download/1.4.326/VulkanUtilityHeaders.tar.zst
        sha512: 5924629755cb1605c4aa4eee20ef7957a9dd8d61e4df548be656d98054f2730c4109693c1bd35811f401f4705d2ccff9fc849be32b0d8480bc3f73541a5e0964
        strip-components: 0
      - type: archive
        dest: .cache/cpm/spirv-headers/4e20
        url: https://github.com/KhronosGroup/SPIRV-Headers/archive/4e209d3d7e.zip
        sha512: f48bbe18341ed55ea0fe280dbbbc0a44bf222278de6e716e143ca1e95ca320b06d4d23d6583fbf8d03e1428f3dac8fa00e5b82ddcd6b425e6236d85af09550a4
      - type: archive
        dest: .cache/cpm/spirv-tools/40eb
        url: https://github.com/KhronosGroup/SPIRV-Tools/archive/40eb301f32.zip
        sha512: 58d0fb1047d69373cf24c73e6f78c73a72a6cca3b4df1d9f083b9dcc0962745ef154abf3dbe9b3623b835be20c6ec769431cf11733349f45e7568b3525f707aa
      - type: archive
        dest: .cache/cpm/mbedtls/3.6.4
        url: https://github.com/Mbed-TLS/mbedtls/releases/download/mbedtls-3.6.4/mbedtls-3.6.4.tar.bz2
        sha512: 6671fb8fcaa832e5b115dfdce8f78baa6a4aea71f5c89a640583634cdee27aefe3bf4be075744da91f7c3ae5ea4e0c765c8fc3937b5cfd9ea73d87ef496524da
      - type: archive
        dest: .cache/cpm/discord-rpc/1cf7
        url: https://github.com/eden-emulator/discord-rpc/archive/1cf7772bb6.zip
        sha512: e9b35e6f2c075823257bcd59f06fe7bb2ccce1976f44818d2e28810435ef79c712a3c4f20f40da41f691342a4058cf86b078eb7f9d9e4dae83c0547c21ec4f97
      - type: archive
        dest: .cache/cpm/simpleini/09c2
        url: https://github.com/brofield/simpleini/archive/09c21bda1d.zip
        sha512: 99779ca9b6e040d36558cadf484f9ffdab5b47bcc8fc72e4d33639d1d60c0ceb4410d335ba445d72a4324e455167fd6769d99b459943aa135bec085dff2d4b7c
      - type: archive
        dest: .cache/cpm/cubeb/fa02
        url: https://github.com/mozilla/cubeb/archive/fa02160712.zip
        sha512: 82d808356752e4064de48c8fecbe7856715ade1e76b53937116bf07129fc1cc5b3de5e4b408de3cd000187ba8dc32ca4109661cb7e0355a52e54bd81b9be1c61
      - type: archive
        dest: .cache/cpm/sdl2/generic
        url: https://github.com/libsdl-org/SDL/archive/54772f345a.zip
        sha512: 2a68a0e01c390043aa9d9df63d8a20a52076c88bb460ac4e0f33194ca7d9bc8fadbbcc04e7506872ac4b6354a73fbc267c036f82200da59465789b87c7d9e3a4
      - type: archive
        only-arches:
          - x86_64
        dest: .cache/cpm/sdl2/steamdeck
        url: https://github.com/libsdl-org/SDL/archive/cc016b0046.zip
        sha512: 34d5ef58da6a4f9efa6689c82f67badcbd741f5a4f562a9c2c30828fa839830fb07681c5dc6a7851520e261c8405a416ac0a2c2513b51984fb3b4fa4dcb3e20b
      - type: archive
        only-arches:
          - x86_64
        dest: .cache/cpm/xbyak/4e44
        url: https://github.com/herumi/xbyak/archive/4e44f4614d.zip
        sha512: 5824e92159e07fa36a774aedd3b3ef3541d0241371d522cffa4ab3e1f215fa5097b1b77865b47b2481376c704fa079875557ea463ca63d0a7fd6a8a20a589e70
      - type: archive
        only-arches:
          - aarch64
        dest: .cache/cpm/oaknut/94c7
        url: https://github.com/merryhime/oaknut/archive/94c726ce03.zip
        sha512: d8d082242fa1881abce3c82f8dafa002c4e561e66a69e7fc038af67faa5eff2630f082d3d19579c88c4c9f9488e54552accc8cb90e7ce743efe043b6230c08ac
      - type: archive
        dest: .cache/cpm/libusb/c060
        url: https://github.com/libusb/libusb/archive/c060e9ce30.zip
        sha512: 44647357ba1179020cfa6674d809fc35cf6f89bff1c57252fe3a610110f5013ad678fc6eb5918e751d4384c30e2fe678868dbffc5f85736157e546cb9d10accc
      - type: archive
        dest: .cache/cpm/vulkanmemoryallocator/1076
        url: https://github.com/GPUOpen-LibrariesAndSDKs/VulkanMemoryAllocator/archive/1076b348ab.zip
        sha512: a46b44e4286d08cffda058e856c47f44c7fed3da55fe9555976eb3907fdcc20ead0b1860b0c38319cda01dbf9b1aa5d4b4038c7f1f8fbd97283d837fa9af9772
      - type: archive
        dest: .cache/cpm/sirit/db1f
        url: https://github.com/eden-emulator/sirit/archive/db1f1e8ab5.zip
        sha512: 73eb3a042848c63a10656545797e85f40d142009dfb7827384548a385e1e28e1ac72f42b25924ce530d58275f8638554281e884d72f9c7aaf4ed08690a414b05
      - type: archive
        dest: .cache/cpm/httplib/a609
        url: https://github.com/yhirose/cpp-httplib/archive/a609330e4c.zip
        sha512: dd3fd0572f8367d8549e1319fd98368b3e75801a293b0c3ac9b4adb806473a4506a484b3d389dc5bee5acc460cb90af7a20e5df705a1696b56496b30b9ce7ed2
      - type: archive
        dest: .cache/cpm/cpp-jwt/9eae
        url: https://github.com/crueter/cpp-jwt/archive/9eaea6328f.zip
        sha512: e237d92c59ebbf0dc8ac0bae3bc80340e1e9cf430e1c1c9638443001118e16de2b3e9036ac4b98105427667b0386d97831415170b68c432438dcad9ef8052de7
      - type: archive
        dest: .cache/cpm/unordered_dense/73f3
        url: https://github.com/martinus/unordered_dense/archive/73f3cbb237.zip
        sha512: c08c03063938339d61392b687562909c1a92615b6ef39ec8df19ea472aa6b6478e70d7d5e33d4a27b5d23f7806daf57fe1bacb8124c8a945c918c7663a9e8532
      - type: archive
        dest: .cache/cpm/ffmpeg/c218
        url: https://github.com/FFmpeg/FFmpeg/archive/c2184b65d2.zip
        sha512: 2a89d664119debbb3c006ab1c48d5d7f26e889f4a65ad2e25c8b0503308295123d5a9c5c78bf683aef5ff09acef8c3fc2837f22d3e8c611528b933bf03bcdd97
      - type: archive
        dest: .cache/cpm/nx_tzdb/250725
        url: https://git.crueter.xyz/misc/tzdb_to_nx/releases/download/250725/250725.zip
        sha512: 8f60b4b29f285e39c0443f3d5572a73780f3dbfcfd5b35004451fadad77f3a215b2e2aa8d0fffe7e348e2a7b0660882b35228b6178dda8804a14ce44509fd2ca
      - type: archive
        dest: .cache/cpm/mcl/7b08
        url: https://github.com/azahar-emu/mcl/archive/7b08d83418.zip
        sha512: f943bac39c1879986decad7a442ff4288eaeca4a2907684c7914e115a55ecc43c2782ded85c0835763fe04e40d5c82220ce864423e489e648e408a84f54dc4f3
      - type: archive
        dest: .cache/cpm/zycore/75a3
        url: https://github.com/zyantific/zycore-c/archive/75a36c45ae.zip
        sha512: 15aa399f39713e042c4345bc3175c82f14dca849fde2a21d4f591f62c43e227b70d868d8bb86beb5f4eb68b1d6bd3792cdd638acf89009e787e3d10ee7401924
      - type: archive
        dest: .cache/cpm/zydis/c2d2
        url: https://github.com/zyantific/zydis/archive/c2d2bab025.zip
        sha512: 7b48f213ff7aab2926f8c9c65195959143bebbfb2b9a25051ffd8b8b0f1baf1670d9739781de674577d955925f91ac89376e16b476a03828c84e2fd765d45020
      - type: archive
        dest: .cache/cpm/quazip-qt6/f838
        url: https://github.com/crueter/quazip-qt6/archive/f838774d63.zip
        sha512: 9f629a438699801244a106c8df6d5f8f8d19e80df54f530a89403a10c8c4e37a6e95606bbdd307f23636961e8ce34eb37a2186d589a1f227ac9c8e2c678e326e
      - type: archive
        dest: .cache/cpm/frozen/61dc
        url: https://github.com/serge-sans-paille/frozen/archive/61dce5ae18.zip
        sha512: 1ae3d073e659c1f24b2cdd76379c90d6af9e06bc707d285a4fafce05f7a4c9e592ff208c94a9ae0f0d07620b3c6cec191f126b03d70ad4dfa496a86ed5658a6d
