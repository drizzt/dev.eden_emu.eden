app-id: dev.eden_emu.eden
runtime: org.kde.Platform
runtime-version: '6.9'
sdk: org.kde.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.llvm20
build-options:
  cflags: -O3
  cxxflags: -O3
command: eden-launcher
finish-args:
  - --device=all
  - --socket=fallback-x11
  - --socket=wayland
  - --socket=pulseaudio
  - --share=network
  - --share=ipc
  - --filesystem=xdg-run/app/com.discordapp.Discord:ro
  - --filesystem=home:ro
  - --filesystem=/run/media:ro
  - --talk-name=org.freedesktop.login1.Manager
modules:
  - name: eden
    buildsystem: cmake-ninja
    builddir: true
    build-options:
      append-path: /usr/lib/sdk/llvm20/bin
      prepend-ld-library-path: /usr/lib/sdk/llvm20/lib
      strip: true
      no-debuginfo: true
      env:
        AR: llvm-ar
        CC: clang
        CXX: clang++
        RANLIB: llvm-ranlib
    config-opts:
      - -Wno-dev
      - -DYUZU_USE_CPM:BOOL=ON
      # Taken from .ci/linux/build.sh
      - -DCMAKE_BUILD_TYPE:STRING=Release
      - -DENABLE_QT_TRANSLATION:BOOL=ON
      - -DUSE_DISCORD_PRESENCE:BOOL=ON
      - -DYUZU_USE_BUNDLED_QT:BOOL=OFF
      - -DYUZU_USE_BUNDLED_SDL2:BOOL=OFF
      - -DYUZU_USE_EXTERNAL_SDL2:BOOL=ON
      - -DYUZU_TESTS:BOOL=OFF
      - -DYUZU_USE_QT_MULTIMEDIA:BOOL=ON
      - -DYUZU_USE_QT_WEB_ENGINE:BOOL=OFF
      - -DYUZU_USE_FASTER_LD:BOOL=ON
      - -DYUZU_ENABLE_LTO:BOOL=ON
      - -DDYNARMIC_ENABLE_LTO:BOOL=ON
      - -DYUZU_ROOM:BOOL=ON
      - -DYUZU_ROOM_STANDALONE:BOOL=OFF
      - -DYUZU_CMD:BOOL=OFF
    secret-opts:
      - -DYUZU_BUILD_PRESET:STRING=$BUILD_PRESET
      - -DYUZU_SYSTEM_PROFILE:STRING=$SYSTEM_PROFILE
    post-install:
      - install -Dm755 ../eden-launcher.sh /app/bin/eden-launcher
      - install -Dm644 ../dev.eden_emu.eden.metainfo.xml /app/share/metainfo/dev.eden_emu.eden.metainfo.xml
      - install -Dm644 ../dist/dev.eden_emu.eden.svg /app/share/icons/hicolor/scalable/apps/dev.eden_emu.eden.svg
      - desktop-file-edit --set-key StartupWMClass --set-value eden --set-key Exec
        --set-value eden-launcher /app/share/applications/dev.eden_emu.eden.desktop
    sources:
      - type: git
        url: https://git.eden-emu.dev/eden-emu/eden.git
      - type: file
        path: dev.eden_emu.eden.metainfo.xml
      - type: file
        path: eden-launcher.sh
      - type: file
        path: compatibility_list.json
        dest: dist/compatibility_list
      - type: archive
        dest: .cache/cpm/boost/1.89.0
        url: https://github.com/boostorg/boost/releases/download/boost-1.89.0/boost-1.89.0-cmake.tar.xz
        sha512: 4fb7f6fde92762305aad8754d7643cd918dd1f3f67e104e9ab385b18c73178d72a17321354eb203b790b6702f2cf6d725a5d6e2dfbc63b1e35f9eb59fb42ece9
      - type: shell
        commands:
          - patch -Np1 -d .cache/cpm/boost/1.89.0 < .patch/boost/0001-clang-cl.patch
          - patch -Np1 -d .cache/cpm/boost/1.89.0 < .patch/boost/0002-use-marmasm.patch
          - patch -Np1 -d .cache/cpm/boost/1.89.0 < .patch/boost/0003-armasm-options.patch
      - type: archive
        dest: .cache/cpm/nlohmann_json/3.12.0
        url: https://github.com/nlohmann/json/archive/refs/tags/v3.12.0.tar.gz
        sha512: 6cc1e86261f8fac21cc17a33da3b6b3c3cd5c116755651642af3c9e99bb3538fd42c1bd50397a77c8fb6821bc62d90e6b91bcdde77a78f58f2416c62fc53b97d
      - type: archive
        dest: .cache/cpm/xbyak/7.22
        url: https://github.com/herumi/xbyak/archive/refs/tags/v7.22.tar.gz
        sha512: 1042090405c426e339506c179d53e91d4d545ce9c9f53d8f797caa092d589f913a9bcb9c8f31c4c60870acb954c556e305fb6732c66bc3c8f1cd924f9172def9
      - type: archive
        dest: .cache/cpm/enet/1.3.18
        url: https://github.com/lsalzman/enet/archive/refs/tags/v1.3.18.tar.gz
        sha512: a0d2fa8c957704dd49e00a726284ac5ca034b50b00d2b20a94fa1bbfbb80841467834bfdc84aa0ed0d6aab894608fd6c86c3b94eee46343f0e6d9c22e391dbf9
      - type: archive
        dest: .cache/cpm/mbedtls/3.6.4
        url: https://github.com/Mbed-TLS/mbedtls/releases/download/mbedtls-3.6.4/mbedtls-3.6.4.tar.bz2
        sha512: 6671fb8fcaa832e5b115dfdce8f78baa6a4aea71f5c89a640583634cdee27aefe3bf4be075744da91f7c3ae5ea4e0c765c8fc3937b5cfd9ea73d87ef496524da
      - type: archive
        dest: .cache/cpm/vulkanutilitylibraries/1.4.328
        url: https://git.crueter.xyz/scripts/VulkanUtilityHeaders/releases/download/1.4.328/VulkanUtilityHeaders.tar.zst
        sha512: 9922217b39faf73cd4fc1510f2fdba14a49aa5c0d77f9ee24ee0512cef16b234d0cabc83c1fec861fa5df1d43e7f086ca9b6501753899119f39c5ca530cb0dae
        strip-components: 0
      - type: archive
        dest: .cache/cpm/discordrpc/1cf7
        url: https://github.com/eden-emulator/discord-rpc/archive/1cf7772bb6.zip
        sha512: e9b35e6f2c075823257bcd59f06fe7bb2ccce1976f44818d2e28810435ef79c712a3c4f20f40da41f691342a4058cf86b078eb7f9d9e4dae83c0547c21ec4f97
      - type: archive
        dest: .cache/cpm/simpleini/4.22
        url: https://github.com/brofield/simpleini/archive/refs/tags/v4.22.tar.gz
        sha512: 6c198636816a0018adbf7f735d402c64245c6fcd540b7360d4388d46f007f3a520686cdaec4705cb8cb31401b2cb4797a80b42ea5d08a6a5807c0848386f7ca1
      - type: archive
        dest: .cache/cpm/cubeb/fa02
        url: https://github.com/mozilla/cubeb/archive/fa02160712.zip
        sha512: 82d808356752e4064de48c8fecbe7856715ade1e76b53937116bf07129fc1cc5b3de5e4b408de3cd000187ba8dc32ca4109661cb7e0355a52e54bd81b9be1c61
      - type: archive
        dest: .cache/cpm/sdl2/generic
        url: https://github.com/libsdl-org/SDL/archive/refs/tags/release-2.32.10.tar.gz
        sha512: d5622d6bb7266f7942a7b8ad43e8a22524893bf0c2ea1af91204838d9b78d32768843f6faa248757427b8404b8c6443776d4afa6b672cd8571a4e0c03a829383
      - type: archive
        dest: .cache/cpm/spirv-headers/01e0
        url: https://github.com/KhronosGroup/SPIRV-Headers/archive/01e0577914.zip
        sha512: d0f905311faf7d743de686fdf241dc4cb0a4f08e2184f5a3b3b2946e680db3cd89eeb72954eafe6fa457f93550e27d516575c8709cb134d8aecc0b43064636ce
      - type: archive
        dest: .cache/cpm/sirit/1.0.2
        url: https://github.com/eden-emulator/sirit/releases/download/v1.0.2/sirit-source-1.0.2.tar.zst
        sha512: 70ea5915e7c2a85fb166f100d03e49ab6697938459d7987d8878bc8acc7d8ecac7c33a5b41909fc8f9053dd042e92b904f0730b8257aab2e5c7e3c09fe907cf8
      - type: archive
        dest: .cache/cpm/spirv-tools/2fa2
        url: https://github.com/crueter/SPIRV-Tools/archive/2fa2d44485.zip
        sha512: 45b198be1d09974ccb2438e8bfa5683f23a0421b058297c28eacfd77e454ec2cf87e77850eddd202efff34b004d8d6b4d12e9615e59bd72be904c196f5eb2169
      - type: archive
        dest: .cache/cpm/libusb/1.0.29
        url: https://github.com/libusb/libusb/archive/refs/tags/v1.0.29.tar.gz
        sha512: 98c5f7940ff06b25c9aa65aa98e23de4c79a4c1067595f4c73cc145af23a1c286639e1ba11185cd91bab702081f307b973f08a4c9746576dc8d01b3620a3aeb5
      - type: archive
        dest: .cache/cpm/vulkanmemoryallocator/3.3.0
        url: https://github.com/GPUOpen-LibrariesAndSDKs/VulkanMemoryAllocator/archive/refs/tags/v3.3.0.tar.gz
        sha512: deb5902ef8db0e329fbd5f3f4385eb0e26bdd9f14f3a2334823fb3fe18f36bc5d235d620d6e5f6fe3551ec3ea7038638899db8778c09f6d5c278f5ff95c3344b
      - type: archive
        dest: .cache/cpm/httplib/0.26.0
        url: https://github.com/yhirose/cpp-httplib/archive/refs/tags/v0.26.0.tar.gz
        sha512: b364500f76e2ecb0fe21b032d831272e3f1dfeea71af74e325f8fc4ce9dcdb3c941b97a5b422bdeafb9facd058597b90f8bfc284fb9afe3c33fefa15dd5a010b
      - type: archive
        dest: .cache/cpm/cpp-jwt/9eae
        url: https://github.com/crueter/cpp-jwt/archive/9eaea6328f.zip
        sha512: e237d92c59ebbf0dc8ac0bae3bc80340e1e9cf430e1c1c9638443001118e16de2b3e9036ac4b98105427667b0386d97831415170b68c432438dcad9ef8052de7
      - type: archive
        dest: .cache/cpm/unordered_dense/4.5.0
        url: https://github.com/martinus/unordered_dense/archive/refs/tags/v4.5.0.tar.gz
        sha512: f9c819e28e1c1a387acfee09277d6af5e366597a0d39acf1c687acf0608a941ba966af8aaebdb8fba0126c7360269c4a51754ef4cab17c35c01a30215f953368
      - type: archive
        dest: .cache/cpm/nx_tzdb/250725
        url: https://git.crueter.xyz/misc/tzdb_to_nx/releases/download/250725/250725.zip
        sha512: 8f60b4b29f285e39c0443f3d5572a73780f3dbfcfd5b35004451fadad77f3a215b2e2aa8d0fffe7e348e2a7b0660882b35228b6178dda8804a14ce44509fd2ca
      - type: archive
        dest: .cache/cpm/mcl/7b08
        url: https://github.com/azahar-emu/mcl/archive/7b08d83418.zip
        sha512: f943bac39c1879986decad7a442ff4288eaeca4a2907684c7914e115a55ecc43c2782ded85c0835763fe04e40d5c82220ce864423e489e648e408a84f54dc4f3
      - type: archive
        dest: .cache/cpm/zycore/75a3
        url: https://github.com/zyantific/zycore-c/archive/75a36c45ae.zip
        sha512: 15aa399f39713e042c4345bc3175c82f14dca849fde2a21d4f591f62c43e227b70d868d8bb86beb5f4eb68b1d6bd3792cdd638acf89009e787e3d10ee7401924
      - type: archive
        dest: .cache/cpm/zydis/c2d2
        url: https://github.com/zyantific/zydis/archive/c2d2bab025.zip
        sha512: 7b48f213ff7aab2926f8c9c65195959143bebbfb2b9a25051ffd8b8b0f1baf1670d9739781de674577d955925f91ac89376e16b476a03828c84e2fd765d45020
      - type: archive
        dest: .cache/cpm/quazip-qt6/f838
        url: https://github.com/crueter/quazip-qt6/archive/f838774d63.zip
        sha512: 9f629a438699801244a106c8df6d5f8f8d19e80df54f530a89403a10c8c4e37a6e95606bbdd307f23636961e8ce34eb37a2186d589a1f227ac9c8e2c678e326e
